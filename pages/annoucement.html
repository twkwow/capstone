<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/styles/admincontent.css">
    <link rel="stylesheet" href="/styles/components.css">
    <link rel="stylesheet" href="/styles/annoucement.css">
    <link rel="stylesheet" href="/styles/verifications.css">
    <title>SecureHold</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
    <link rel="icon" href="/resources/images/logo.png" type="image/png">
    <script src="/components/sidebar.js" type="text/javascript" defer></script>
    <script src="/components/header.js" type="text/javascript" defer></script>
    <script src="/components/popupModal.js" type="text/javascript" defer></script>
    <script src="/components/snackbarNotification.js" type="text/javascript" defer></script>
</head>

<body style="display: flex;">
    <sidebar-component></sidebar-component>
    <div class="content-container">
        <header-component></header-component>

        <div class="content" style="margin: 30px">
            <span class="content-title">Add Annoucements</span>
            <form class="announcements-container" onsubmit="insertAnnoucement(event)">

                <div class="add-ann-title">Title</div>
                <div class="add-ann-content">
                    <textarea id="title" required class="announcements-textarea" rows="1" placeholder="Add your text"></textarea>
                </div>

                <div class="add-ann-title">Content</div>
                <div class="add-ann-content">
                    <textarea id="content" required class="announcements-textarea" rows="10" placeholder="Add your text"></textarea>
                </div>

                <div class="add-ann-btn">
                    <input type="submit" id="add_ann" class="add-annoucements-button" value="Add Annoucement">
                </div>
            </form>

            <hr class="content-divider">

            <span class="content-title">Previous Annoucements</span>
            <div id="prevAnnoucements"></div>
            <!-- <div class="annoucement-card">
                <div class="annoucement-container">
                    <div class="annoucement-container1">
                        <div class="annoucement-title">
                            <span>locker maintenance today</span>
                        </div>
                        <div class="annoucement-content">
                            <span> AFASJDAFKSDFLSKAFJSAFLASKJADSFLAKFASJFSAFSLKFJAFDSLAFADJFKLDFDJ</span>
                        </div>
                    </div>
                    <div class="annoucement-container2">
                        <span>Admin Username</span>
                    </div>
                    <div class="annoucement-container3">
                        <span>18/02/2024 8:50pm</span>
                    </div>
                    <div class="annoucement-delete">
                        <div class="ann-delete-text" onclick="showPopup('ann-delete', true)">
                            <a href="#" role="button">
                                Delete
                            </a>
                        </div>
                    </div>
                </div>
            </div> -->

            <!-- <div class="annoucement-card">
                <div class="annoucement-container">
                    <div class="annoucement-container1">
                        <div class="annoucement-title">
                            <span>locker maintenance today</span>
                        </div>
                        <div class="annoucement-content">
                            <span> AFASJDAFKSDFLSKAFJSasdadsadasdsadsadsadd;ds
                                adsal;kdsadl;sakdsa;ldksa;ldsakld;sakdl;sakdl;saksd;lasa;ldksadsl;akdsa;ldk;lksd;lak;laks;
                                a;sldksal;dakdasl;dksal;dksal;dsakl;dsak;dlsakdl;sakdas;ldksal;;l;lakds;la;kl
                                a;sldkadl;aal;sdksa;lda
                                AFLASKJADSFLAKFASJFSAFSLKFJAFDSLAFADJFKLDFDJ</span>
                        </div>
                    </div>
                    <div class="annoucement-container2">
                        <span>Admin Username</span>
                    </div>
                    <div class="annoucement-container3">
                        <span>18/02/2024 8:50pm</span>
                    </div>
                    <div class="annoucement-delete">
                        <div class="ann-delete-text" onclick="showPopup('ann-delete', true)">
                            <a href="#" role="button">
                                Delete
                            </a>
                        </div>
                    </div>
                </div>
            </div> -->

        </div>
    </div>

    <popupmodal-component modalId="ann-delete" modalClass="popup-container-ann-delete">
        <div class="ann-delete-text1">
            <strong>Delete Annoucement</strong>
        </div>
        <div class="ann-delete-text1" style="margin-top: 10px;">
            Permanently delete the annoucement? You can't undo this
        </div>
        <div class="pop-container">
            <div class="annoucement-cancel-pop">
                <div href="#" role="button">
                    <div class="ann-cancel-text" onclick="showPopup('ann-delete', false)">
                        Cancel
                    </div>
                </div>
            </div>
            <div class="annoucement-confirm-pop">
                <div onclick="deleteAnnoucement()">
                    <div class="ann-delete-text">
                        Confirm
                    </div>
                </div>
            </div>
        </div>
    </popupmodal-component>

    <snackbar-component snackbarId="insertAnnoucement">Annoucement Uploaded</snackbar-component>
</body>

</html>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"></script>
<script src="/app.js"></script>

<script>
    function previousAnnoucementsHTML(_id, title, content, admin, time) {
        return `
        <div class="annoucement-card">
            <div class="annoucement-container">
                <div class="annoucement-container1">
                    <div class="annoucement-title">
                        <span>${title}</span>
                    </div>
                    <div class="annoucement-content">
                        <span> ${content} </span>
                    </div>
                </div>
                <div class="annoucement-container2">
                    <span>${admin}</span>
                </div>
                <div class="annoucement-container3">
                    <span>${time}</span>
                </div>
                <div class="annoucement-delete">
                    <div class="ann-delete-text" onclick="showPopup('ann-delete', true)">
                        <a href="#" role="button">
                            Delete
                        </a>
                    </div>
                </div>
            </div>
        </div>
        `
    }

    async function getAnnoucements() {
        await axios.get(apiLink + "annoucements/getAllAnnoucements")
        .then ( (res) => {
            //limit show up to 5 annoucements
            const approvalArr = res.data.data.slice(0,5)
            var innerHTML = ""
            approvalArr.forEach( (annoucement) => {
                innerHTML += previousAnnoucementsHTML(annoucement._id, annoucement.title, annoucement.content, annoucement.admin, moment(annoucement.timestamp).format('DD-MMM-YYYY, h:mm:ss a'))
            })
            document.getElementById("prevAnnoucements").innerHTML = innerHTML
        })
    }
    getAnnoucements()

    async function insertAnnoucement() {
        event.preventDefault()

        const title = document.getElementById('title').value
        const content = document.getElementById('content').value
        const formattedTitle = title.replace(/\n/g, '<br>');
        const formattedContent = content.replace(/\n/g, '<br>');

        const annoucementForm = new FormData()
        annoucementForm.append("title", formattedTitle)
        annoucementForm.append("content", formattedContent)

        await axios.post(apiLink + 'annoucements/insertAnnoucement', annoucementForm)
        .then( () => {
            showSnackbar("insertAnnoucement")
        })
        .catch((e) => {
            console.log(e)
        } )
    }
</script>
