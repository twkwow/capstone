<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/styles/verifications.css">
    <title>SecureHold - Sign Up</title>
    <link rel="icon" href="/resources/images/logo.png" type="image/png">
    <script src="/components/popupModal.js" type="text/javascript" defer></script>
</head>

<body class="verifications-container" onload="generateCaptcha()">
    <header class="logo-container">
        <img src="/resources/images/securehold.png" alt="securehold">
    </header>
    
    <form class="form-container" onsubmit="submitApproval(event)">
        <h2>Sign Up</h2>

        <input type="text" id="username" class="form-input" required placeholder="Username"/>
        <input type="email" id="email" class="form-input" title="dsadsadas" required placeholder="Email Address">
        <div class="send-code-container">
            <div style="display: flex; flex-direction: column; color:#007bff;">
                <input type="text" id="sendcode" class="form-input" required placeholder="Verification Code">
                <div id="sendforgotcode" class="send-code" onclick="sendCode()">Send Code</div>
            </div>
        </div>
        <input type="password" id="newpassword" class="form-input" required placeholder="Password">
        <input type="password" id="newpasswordre" class="form-input" required placeholder="Re-type Password">
        <div class="container1">
            <input type="text" id="captcha-input" name="captcha" required placeholder="Code">
            <div id="captcha-container" onclick="generateCaptcha()">
                <img id="captcha-img" alt="Captcha Image">
            </div>
        </div>
        <div id="alertText" class="alert-text"></div>
        <input type="submit" class="form-button" value="Sign Up">
        <div class="form-nav">
            Back to <a href="login.html">Log In</a>
        </div>
    </form>
        
    <footer class="footer-terms">
        <span onclick="showPopup(tos, true)">Terms of Services</span>
        &nbsp; | &nbsp;
        <span>Privacy Policy</span>
        &nbsp; | &nbsp;
         <span>Disclaimer</span>      	
    </footer>
    
    <!-- <div id='tos' class="popup-backdrop" onclick="showPopup('tos', false)">
        <div class="popup-container" onclick="event.stopPropagation();">
            Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
        </div>
    </div>

    <div id='codeSent' class="popup-backdrop" onclick="showPopup('codeSent', false)">
        <div class="popup-container" onclick="event.stopPropagation();">
            A code has been sent to your email !
        </div>
    </div>
    
    <div id='submitApproval' class="popup-backdrop" onclick="showPopup('submitApproval', false)">
        <div class="popup-container" onclick="event.stopPropagation();">
            You have successfully signed up and is being sent for approval!
        </div>
    </div> -->

    <popupmodal-component></popupmodal-component>
</body>
</html>
    
<script src="/app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="/captcha.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js"></script>

<script>
    //popupmodal messages
    const tos = "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum."
    const codeSent = "A code has been sent to your email !"
    const submitApproval = "You have successfully signed up and is being sent for approval!"

    function sendCode() {
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const email = document.getElementById("email").value

        if (!emailPattern.test(email)) {
            return document.getElementById("alertText").innerHTML = "Please enter a valid email address"
        }
             
        const emailForm = new FormData()
        emailForm.append("email", email)

        axios.post(apiLink + "admins/sendCode", emailForm)
        .then( (resp) => {
            showPopup(codeSent, true)
        })
        .catch( (error) => {
            console.log("API Error: " + error)
        })
    }

    function submitApproval(event) {
        event.preventDefault();
        
        const username = event.target.querySelector("#username").value;
        const email = event.target.querySelector("#email").value;
        const password = event.target.querySelector("#newpassword").value;
        const passwordRe = event.target.querySelector("#newpasswordre").value;

        //code if password don't match
        if (password != passwordRe) {
            return document.getElementById("alertText").innerHTML = "Passwords not matching"
        }

        const approvalRequest = new FormData()
        approvalRequest.append("username", username)
        approvalRequest.append("email", email)
        approvalRequest.append("password", password)

        axios.post(apiLink + "admins/submitApproval", approvalRequest)
        .then( (resp) => {
            console.log(resp)
            showPopup(submitApproval, true)
        })
        .catch( (error) => {
            console.log("API Error: " + error)
        })
    }
</script>